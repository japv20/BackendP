<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title> Ragnvindr </title>
</head>
<body id="home">
    <div id="background-picture"></div>
    </div>
    <header>
        <nav>
            <a href="#home"> Home </a>
            <a href="#menu"> Menu/Order </a>
            <a href="#location"> Location </a>
            <i class="fa fa-google" id="google-icon"></i>
            <i class="fa fa-user circle" id="user-login"></i>
            <i class="fa fa-shopping-cart"></i>
        </nav>

        <img id="pic" src="back-pic.jpg">

        <h1 id="restaurant"> Title of Restaurant </h1>
    </header>

    <main>

        <h1 id="menu"> Menu </h1>
        <div id="user-form">
            <form>
                <label for="email"> Email: </label>
                <input type="email" name="email" id="user-email" required>
                <button id="get-link"> Send me a magic link </button>
            </form>
        </div>
        <!-- <h2 id="starters"> Starters </h2>
        <h2 id="main"> Main </h2>
        <h2 id="desserts"> Desserts </h2>
        <h2 id="drinks"> Drinks </h2> -->
        <ul id="menus"></ul>
        <div id="edit-modal">
            <div class="content-to-edit">
                <p> Testing </p>
                <button> Save </button>
                <button> Cancel </button>
            </div>
        </div>

        <h1 id="location"> Where to find us </h1>
        <p> Address </p>
        <h1> Add your favourite plate! </h1>
        
        <form method="POST" id="addForm">
            <label for="category"> Category: </label>
            <select name="categories" id="inputCategories">
                <option value="Starters"> Starters </option>
                <option value="Main"> Main </option>
                <option value="Drinks"> Drinks </option>
                <option value="Desserts"> Desserts </option>
            </select>
            <label for="plate"> Plate </label> <br>
            <input type="text" name="name" id="inputDish"> <br>
           
            <label for="description"> Description </label> <br>
            <input type="text" name="description" id="inputDescription"> <br>
            
            <label for="price"> Price </label> <br>
            <input type="number" name="price" id="inputPrice"> <br>
            
            <label for="image-food"> Attach Image </label> <br>
            <input type="file" name="picture" id="inputImg"> <br>
            
            <button id="submition" type="submit"> Submit </button>
        </form>
        <br>
        <!-- <button id="edit"> Edit </button> -->
    </main>

    <footer>
        <h1> Footer </h1>
    </footer>
    
</body>

<script src="https://unpkg.com/@supabase/supabase-js"> </script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"> </script>
<script>

    document.addEventListener("DOMContentLoaded", (event) => {

        //Google signup
        const googleIcon = document.getElementById('google-icon')
        googleIcon.addEventListener('click', (event) => {
            event.preventDefault()
            console.log("Hello")
            const { createClient } = supabase
            supabase = createClient('https://nzbdfmiovbsqjwwhilhn.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNDM5ODI5NiwiZXhwIjoxOTQ5OTc0Mjk2fQ.KsfwqP7XECEHLB8NIv80D5KztYINq9mI73qzHMoneuE')
            console.log(supabase);

            supabase.auth.signIn({provider:'google'})
        })

        // Magic link sign up
        const userToLogIn = document.getElementById('user-login');
        const userForm = document.getElementById('user-form')
        userToLogIn.addEventListener('click', (event) => {
            event.preventDefault();
            console.log("Hello")
            userForm.style.display = "block";
        })

        const emailAddress = document.getElementById('user-email')
        const buttonForm = document.getElementById('get-link')
        buttonForm.addEventListener('click', (event) => {
            event.preventDefault();
            console.log("hello")
            console.log(`This is the email: ${emailAddress.value}`)

            fetch('http://localhost:3000/login', {
                headers: {
                        'Accept':'application/json',
                        'Content-Type':'application/json'
                    },
                    method: 'POST',
                    body: JSON.stringify({email:emailAddress.value}) 
            })
        })

        // Calling API meals
        fetch('http://localhost:3000/meals')
        .then(response => response.json())
            .then ((data) => {
                console.log(data); // array of meals
                let listHolder = document.getElementById('menus');
                data.forEach(item => {
                    listHolder.innerHTML += 
                    ` <h3> ${item.name} </h3>
                    <p> <i> ${item.category} </p> </i>
                    <p> ${item.description} </p>
                    <p> ${item.price} </p>
                    <img src=${item.picture}/> <br>
                    <button id="${item.id}" class="edit"> Edit </button>
                    <button id="${item.id}" class="delete"> Delete </button>
                    `
                });
            })
        })

        // Cleaning form inputs
        function clearForm() {
                inputCategories.value = "";
                inputDish.value = "";
                inputDescription.value = "";
                inputPrice.value = "";
                inputImg.value = "";
        }
        
        // Inserting data to supabase table
        const mealForm = document.querySelector('#addForm')
        
        mealForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            console.log("I have been clicked")

            let mealCategory = document.getElementById('inputCategories').value
            let mealName = document.getElementById('inputDish').value;
            let mealDescription = document.getElementById('inputDescription').value;
            let mealPrice = document.getElementById('inputPrice').value;
            let mealImage = document.getElementById('inputImg').value;
        
            fetch('http://localhost:3000/meals', {
                    headers: {
                        'Accept':'application/json',
                        'Content-Type':'application/json'
                    },
                    method: 'POST',
                    body: JSON.stringify({category:mealCategory, plate:mealName, description:mealDescription, price:mealPrice, img_url:mealImage})
                })
            location.reload()
        })

        // Start editing meals
            // const editOption = document.getElementById('edit');
            // console.log(editOption)
            // editOption.addEventListener('click', (event) => {
            //     event.preventDefault();
            //     console.log("Hello");
            // })
            let modal = document.getElementById('edit-modal')
            let editButtons = document.querySelectorAll('.edit');
            console.log(editButtons)
            editButtons.forEach(element => {
                console.log("Hello")
            })
</script>

</html>